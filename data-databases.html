
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Databases &#8212; Coding for Economists</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="canonical" href="https://aeturrell.github.io/coding-for-economists/data-databases.html" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Advanced Data" href="data-advanced.html" />
    <link rel="prev" title="Sharing Data" href="data-sharing.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/smith_lovelace.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Coding for Economists</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Introduction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="code-preliminaries.html">
   Preliminaries
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-basics.html">
   Coding Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="workflow-basics.html">
   Workflow Basics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-where.html">
   Writing Code
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="data-analysis-quickstart.html">
   Data Analysis Quickstart
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-intro.html">
   Working with Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-read-and-write.html">
   Reading and Writing Files
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-numbers.html">
   Numbers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-categorical.html">
   Categorical Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-missing-values.html">
   Missing Values
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-boolean.html">
   Boolean Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-joining-data.html">
   Joins
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Coding
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="code-best-practice.html">
   Tips for Better Coding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-advcd-best-practice.html">
   Better Coding
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="code-advanced.html">
   More Coding
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data Visualisation
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="vis-intro.html">
   Intro to Data Visualisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vis-common-plots.html">
   Common Plots
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vis-narrative.html">
   Narrative Data Visualisation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="vis-animation.html">
   Animation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  More Data
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="data-exploratory-analysis.html">
   Exploratory Data Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-spreadsheets.html">
   Spreadsheets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-extraction.html">
   Getting Data
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-sharing.html">
   Sharing Data
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Databases
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="data-advanced.html">
   Advanced Data
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Workflow
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="auto-research-outputs.html">
   Automating Research Outputs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-markdown.html">
   Markdown
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-command-line.html">
   The Command Line
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-environments.html">
   Virtual Code Environments
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-quarto.html">
   Combining Code and Text in Quarto Markdown
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="wrkflow-rap.html">
   Reproducible Analysis
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Econometrics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-probability-random.html">
   Probability and Random Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-statistics.html">
   Statistics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-regression.html">
   Regression
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-causal-inference.html">
   Causal Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="econmt-bayesian.html">
   Bayesian Inference
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Craft
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="craft-intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="craft-writing-papers.html">
   Writing Papers
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="craft-research-blogs.html">
   Research Blog Posts
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="craft-technical-reports.html">
   Writing Technical Reports
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="craft-extended-abstracts.html">
   Extended Abstracts
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Time
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="time-intro.html">
   Introduction to Time
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="time-series.html">
   Time Series
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="time-fcasts-env.html">
   Forecasting Exercises
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Text Analysis
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="text-intro.html">
   Introduction to Text
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="text-regex.html">
   Regular Expressions, aka regex
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="text-nlp.html">
   Natural Language Processing
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Geospatial
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="geo-intro.html">
   Intro to Geo-Spatial Analysis
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="geo-vis.html">
   Geo-Spatial Visualisation
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Mathematics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="maths-maths-coding.html">
   Maths with Code
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Coming from ...
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-stata.html">
   Coming from Stata
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-matlab.html">
   Coming from Matlab
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-r.html">
   Coming from R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coming-from-excel.html">
   Coming from Excel
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  End Matter
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="acknowledgements.html">
   Acknowledgements and Contributing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   Bibliography
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/data-databases.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/aeturrell/coding-for-economists"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/aeturrell/coding-for-economists/issues/new?title=Issue%20on%20page%20%2Fdata-databases.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/aeturrell/coding-for-economists/main?urlpath=tree/data-databases.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/aeturrell/coding-for-economists/blob/main/data-databases.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prerequisites">
     Prerequisites
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#database-basics">
   Database Basics
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#connecting-to-databases">
   Connecting to Databases
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#working-with-databases-directly">
   Working with Databases Directly
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-a-database">
     Creating a Database
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#basic-sql-queries">
   Basic SQL Queries
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#joins">
     Joins
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#functions">
     Functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sql-with-pandas">
   SQL with
   <strong>
    pandas
   </strong>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#sql-with-sqlmodel">
   SQL with
   <strong>
    SQLModel
   </strong>
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#creating-a-sql-database-with-sqlmodel">
     Creating a SQL Database with
     <strong>
      SQLModel
     </strong>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reading-from-sql-using-sqlmodel">
     Reading from SQL using
     <strong>
      SQLModel
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#where-to-learn-more-about-sql">
   Where to Learn More About SQL
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="databases">
<span id="id1"></span><h1>Databases<a class="headerlink" href="#databases" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>A huge amount of data lives in databases, so it’s essential that you know how to access them. Sometimes you can ask someone to download a snapshot into a .csv for you, but this gets painful quickly: every time you need to make a change you’ll have to communicate with another human. You want to be able to reach into the database directly to get the data you need, when you need it.</p>
<p>In this chapter, you’ll first learn the basics of Python packages that can interact with SQL databses: how to use them to connect to a database and then retrieve data with a SQL<a class="footnote-reference brackets" href="#import-databases-1" id="id2">1</a> query. <strong>SQL</strong>, short for <strong>s</strong>tructured <strong>q</strong>uery <strong>l</strong>anguage, is the lingua franca of databases, and is an important language for all data scientists to learn. You won’t become a SQL master by the end of the chapter, but you will be able to identify the most important components and understand what they do.</p>
<div class="section" id="prerequisites">
<h3>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h3>
<p>You will need the <strong>pandas</strong> and <strong>SQLModel</strong> packages for this chapter. You probably already have <strong>pandas</strong> installed; to install <strong>SQLModel</strong>, run <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">sqlmodel</span></code> on your computer’s command line.</p>
</div>
</div>
<div class="section" id="database-basics">
<h2>Database Basics<a class="headerlink" href="#database-basics" title="Permalink to this headline">¶</a></h2>
<p>At the simplest level, you can think about a database as a collection of data frames, called <strong>tables</strong> in database terminology.
Like a <strong>pandas</strong> dataframe, a database table is a collection of named columns, where every value in the column is the same type.
There are three high level differences between data frames and database tables:</p>
<ul class="simple">
<li><p>Database tables are stored on disk (ie on file) and can be arbitrarily large.
Data frames are stored in memory, and are fundamentally limited (although that limit is still big enough for many problems). You can think about the difference between on disk and in memory as being like the difference between long-term and short-term memory (and you have much more limited capacity in the latter).</p></li>
<li><p>Database tables almost always have indexes.
Much like the index of a book, a database index makes it possible to quickly find rows of interest without having to look at every single row.</p></li>
<li><p>Most classical databases are optimised for rapidly collecting data, not analysing existing data.
These databases are called <strong>row-oriented</strong> because the data is stored row-by-row, rather than column-by-column.
More recently, there’s been much development of <strong>column-oriented</strong> databases that make analysing the existing data much faster.</p></li>
</ul>
<p>Databases are run by database management systems (<strong>DBMS</strong>’s for short), which come in three basic forms:</p>
<ul class="simple">
<li><p><em>Client-server</em> DBMS’s run on a powerful central server, which you connect from your computer (the client). They are great for sharing data with multiple people in an organisation. Popular client-server DBMS’s include PostgreSQL, MariaDB, SQL Server, and Oracle.</p></li>
<li><p><em>Cloud</em> DBMS’s, like Snowflake, Amazon’s RedShift, and Google’s BigQuery, are similar to client server DBMS’s, but they run in the cloud. This means that they can easily handle extremely large datasets and can automatically provide more compute resources as needed.</p></li>
<li><p><em>In-process</em> DBMS’s, like SQLite or duckdb, run entirely on your computer. They’re great for working with large datasets where you’re the primary user.</p></li>
</ul>
</div>
<div class="section" id="connecting-to-databases">
<h2>Connecting to Databases<a class="headerlink" href="#connecting-to-databases" title="Permalink to this headline">¶</a></h2>
<p>To connect to a database from Python, there are a number of options, but it does depend on what <em>kind</em> of database you are connecting to. The steps (eg connect to the database, upload data, run SQL series) are similar though, so we won’t lose much by just choosing one example—a SQLite database. SQLite is a small, fast, self-contained, SQL database engine and the most used database engine in the world. A lot of the data on your computer and mobile phone will in fact be in SQLite databases. (Simon Willison has some <a class="reference external" href="https://dogsheep.github.io/">great tools</a> to help export some of the data that you’ve created!)</p>
<p>We will always need two steps though, regardless of what kind of SQL database we are connecting to:</p>
<ul class="simple">
<li><p>You’ll always use a database interface that provides a connection to the database, for example Python’s built-in <strong>sqlite</strong> package</p></li>
<li><p>You’ll also use a package that pushes and/or pulls data to/from the database, for example <strong>pandas</strong></p></li>
</ul>
<p>The precise details of the connection varies a lot from DBMS to DBMS so unfortunately we can’t cover all the details here. The initial setup will often take a little fiddling (and maybe some research) to get right, but you’ll generally only need to do it once. We’ll do the best we can to cover some basics here.</p>
<p>Setting up a client-server or cloud DBMS would be a pain for this book, so we’ll instead use an in-computer DBMS.</p>
</div>
<div class="section" id="working-with-databases-directly">
<h2>Working with Databases Directly<a class="headerlink" href="#working-with-databases-directly" title="Permalink to this headline">¶</a></h2>
<p>Let’s connect to a small SQLite database called the <a class="reference external" href="https://database.guide/2-sample-databases-sqlite/">Chinook database</a>, which contains information about the artists, songs, and albums from a music shop, as well as information on the shop’s employees, customers, and the customers purchases. This information is contained in eleven tables. The figure below shows the data schema:</p>
<p><img alt="Data schema of Chinook database" src="https://github.com/arjunchndr/Analyzing-Chinook-Database-using-SQL-and-Python/raw/master/chinook-schema.svg" /></p>
<p>You can download the file, Chinook.sqlite, from the github repository of this book <a class="reference external" href="https://github.com/aeturrell/python4DS/tree/main/data">here</a>; on your computer, you’ll need to save it in a subdirectory (relative to where your code is being executed) called ‘data’ to work through the exercises below.</p>
<p>For starters, let’s use Python’s built in <strong>sqlite3</strong> engine to connect to the database and execute a very simple SQL query to select the first ten entries from the ‘Artists’ table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;data/Chinook.sqlite&quot;</span><span class="p">)</span>

<span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Artist LIMIT 10;&quot;</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">rows</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(1, &#39;AC/DC&#39;),
 (2, &#39;Accept&#39;),
 (3, &#39;Aerosmith&#39;),
 (4, &#39;Alanis Morissette&#39;),
 (5, &#39;Alice In Chains&#39;),
 (6, &#39;Antônio Carlos Jobim&#39;),
 (7, &#39;Apocalyptica&#39;),
 (8, &#39;Audioslave&#39;),
 (9, &#39;BackBeat&#39;),
 (10, &#39;Billy Cobham&#39;)]
</pre></div>
</div>
</div>
</div>
<p>Note that the output here is in the form a Python object called a tuple. If we wanted to put this into a <strong>pandas</strong> dataframe, we can just pass it straight in:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>AC/DC</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>Accept</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>Aerosmith</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>Alanis Morissette</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>Alice In Chains</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>Antônio Carlos Jobim</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>Apocalyptica</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>Audioslave</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>BackBeat</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>Billy Cobham</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Another useful hint is that if you’re not sure what the column names are, you can obtain them from:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cursor</span><span class="o">.</span><span class="n">description</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;ArtistId&#39;, &#39;Name&#39;]
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-a-database">
<h3>Creating a Database<a class="headerlink" href="#creating-a-database" title="Permalink to this headline">¶</a></h3>
<p>Often, you’ll want to create a SQL database to later (efficiently) access cuts of data. Let’s create a test database directly using the <strong>sqlite</strong> package. This process involves a <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">TABLE</span></code> statement, then the name of the table followed by the names of the columns and their data types.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">create_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;CREATE TABLE test (country VARCHAR(20), gdp REAL, health INTEGER);&quot;&quot;&quot;</span>
<span class="n">con_new</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;data/test_database.sqlite&quot;</span><span class="p">)</span>
<span class="n">con_new</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">create_query</span><span class="p">)</span>
<span class="n">con_new</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>If this runs, then you’ve created a test database! (You can check the data directory on your own computer to see if it worked, but you’ll get an error if the data directory doesn’t already exist.)</p>
<p>Let’s now fill the database with some values:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_data</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;US&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;UK&quot;</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;France&quot;</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>

<span class="n">con_new</span><span class="o">.</span><span class="n">executemany</span><span class="p">(</span><span class="s2">&quot;INSERT INTO test VALUES(?, ?, ?)&quot;</span><span class="p">,</span> <span class="n">test_data</span><span class="p">)</span>
<span class="n">con_new</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Finally, let’s check if this has worked:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">con_new</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM test&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;US&#39;, 1.0, 3), (&#39;UK&#39;, 0.6, 2), (&#39;France&#39;, 0.8, 1)]
</pre></div>
</div>
</div>
</div>
<p>Whahey, this worked!</p>
</div>
</div>
<div class="section" id="basic-sql-queries">
<h2>Basic SQL Queries<a class="headerlink" href="#basic-sql-queries" title="Permalink to this headline">¶</a></h2>
<p>A full description of SQL queries is outside the scope of this book, but we’ll try and arm you with the basics.  The top-level components of SQL are called <strong>statements</strong>. Common statements include <code class="docutils literal notranslate"><span class="pre">CREATE</span></code> for defining new tables, <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> for adding data, and <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> for retrieving data. We will on focus on <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statements, also called <strong>queries</strong>, because they are almost exclusively what you’ll use as a data scientist.</p>
<p>A query is made up of <strong>clauses</strong>. There are six important clauses: <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, <code class="docutils literal notranslate"><span class="pre">FROM</span></code>, <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>, <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code>, <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>, and <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code>. Every query must have the <code class="docutils literal notranslate"><span class="pre">SELECT</span></code><a class="footnote-reference brackets" href="#import-databases-4" id="id3">2</a> and <code class="docutils literal notranslate"><span class="pre">FROM</span></code><a class="footnote-reference brackets" href="#import-databases-5" id="id4">3</a> clauses and the simplest query is <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">table</span></code>, which selects all columns from a specified table called “table”. <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> and <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> control which rows are included and how they are ordered. <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> converts the query to a summary, causing aggregation to happen. <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code> limits how many rows are returned.</p>
<p>Important: in SQL, the order matters. You must always write the clauses in the order <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, <code class="docutils literal notranslate"><span class="pre">FROM</span></code>, <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>, <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>, <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code>. Confusingly, this order doesn’t match how the clauses actually evaluated which is first <code class="docutils literal notranslate"><span class="pre">FROM</span></code>, then <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>, <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code>, <code class="docutils literal notranslate"><span class="pre">SELECT</span></code>, and <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code>.</p>
<p>Let’s look at a few of these in action. To get a few entries, it’s</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">Artist</span> <span class="k">LIMIT</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<p>To be specific about columns, it’s</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">Artist</span> <span class="k">LIMIT</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<p>To reverse order, use “ORDER BY” and then “DESC”. For example, this query gives us the ten longest tracks</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="n">milliseconds</span> <span class="k">FROM</span> <span class="n">track</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">milliseconds</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">10</span><span class="p">;</span>
</pre></div>
</div>
<p>Another headline feature is being able to filter. For example, we could ask for the first ten tracks that are at least 3 minutes long. Let’s run this one for real:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql_query</span> <span class="o">=</span> <span class="s2">&quot;SELECT name, milliseconds FROM track WHERE milliseconds &gt; 1e3*3*60 ORDER BY milliseconds ASC LIMIT 10;&quot;</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_query</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">rows</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;Bodies&#39;, 180035),
 (&#39;Vivo Isolado Do Mundo&#39;, 180035),
 (&#39;Elvis Ate America&#39;, 180166),
 (&#39;Remote Control&#39;, 180297),
 (&#39;Promises&#39;, 180401),
 (&#39;Emergency&#39;, 180427),
 (&#39;À Vontade (Live Mix)&#39;, 180636),
 (&#39;Hyperconectividade&#39;, 180636),
 (&#39;On Fire&#39;, 180636),
 (&#39;Fascinação&#39;, 180793)]
</pre></div>
</div>
</div>
</div>
<p>Let’s try a groupby. This one will groupby album to find the average track length in minutes for (the first five) albums:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql_groupby</span> <span class="o">=</span> <span class="s2">&quot;SELECT albumid, AVG(milliseconds)/1e3/60 FROM track GROUP BY albumid ORDER BY AVG(milliseconds) ASC LIMIT 5;&quot;</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_groupby</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">rows</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(340, 0.863),
 (345, 1.11065),
 (318, 1.6882166666666667),
 (314, 1.69135),
 (328, 1.8377666666666668)]
</pre></div>
</div>
</div>
</div>
<div class="section" id="joins">
<h3>Joins<a class="headerlink" href="#joins" title="Permalink to this headline">¶</a></h3>
<p>If you’re familiar with joins in <strong>pandas</strong>, SQL joins are very similar. Let’s see if we can join the ‘album’ and ‘track’ tables to find the <em>name</em> of the albums in the above query.</p>
<p>Note that as soon as we have the <em>same</em> column names in more than one table, we need to specify the table we are referring to when we use that column name. There are different options for joins (eg <code class="docutils literal notranslate"><span class="pre">INNER</span></code>, <code class="docutils literal notranslate"><span class="pre">LEFT</span></code>) that you can find out more about <a class="reference external" href="https://en.wikipedia.org/wiki/Join_(SQL)">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sql_join</span> <span class="o">=</span> <span class="s2">&quot;SELECT track.albumid, AVG(milliseconds)/1e3/60, album.title FROM track INNER JOIN album ON (track.albumid = album.albumid) GROUP BY album.albumid ORDER BY AVG(milliseconds) ASC LIMIT 5;&quot;</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql_join</span><span class="p">)</span>
<span class="n">rows</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
<span class="n">rows</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(340, 0.863, &quot;Liszt - 12 Études D&#39;Execution Transcendante&quot;),
 (345, 1.11065, &quot;Monteverdi: L&#39;Orfeo&quot;),
 (318, 1.6882166666666667, &#39;SCRIABIN: Vers la flamme&#39;),
 (314, 1.69135, &#39;English Renaissance&#39;),
 (328, 1.8377666666666668, &#39;Charpentier: Divertissements, Airs &amp; Concerts&#39;)]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<p>We already snuck in one function: <code class="docutils literal notranslate"><span class="pre">AVG</span></code>. Others that you can apply to columns include <code class="docutils literal notranslate"><span class="pre">SUM</span></code>, <code class="docutils literal notranslate"><span class="pre">MIN</span></code>, <code class="docutils literal notranslate"><span class="pre">MAX</span></code>, <code class="docutils literal notranslate"><span class="pre">FIRST</span></code>, <code class="docutils literal notranslate"><span class="pre">LAST</span></code> and <code class="docutils literal notranslate"><span class="pre">COUNT</span></code> (the data scientist’s friend). You can find out more about SQL functions <a class="reference external" href="https://www.tutorialspoint.com/sql/sql-useful-functions.htm">here</a>.</p>
</div>
</div>
<div class="section" id="sql-with-pandas">
<h2>SQL with <strong>pandas</strong><a class="headerlink" href="#sql-with-pandas" title="Permalink to this headline">¶</a></h2>
<p><strong>pandas</strong> is well-equipped for working with SQL. We can simply push the query we just created straight through using its <code class="docutils literal notranslate"><span class="pre">read_sql</span></code> function—but bear in mind we need to pass in the connection we created to the database too:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">sql_join</span><span class="p">,</span> <span class="n">con</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AlbumId</th>
      <th>AVG(milliseconds)/1e3/60</th>
      <th>Title</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>340</td>
      <td>0.863000</td>
      <td>Liszt - 12 Études D'Execution Transcendante</td>
    </tr>
    <tr>
      <th>1</th>
      <td>345</td>
      <td>1.110650</td>
      <td>Monteverdi: L'Orfeo</td>
    </tr>
    <tr>
      <th>2</th>
      <td>318</td>
      <td>1.688217</td>
      <td>SCRIABIN: Vers la flamme</td>
    </tr>
    <tr>
      <th>3</th>
      <td>314</td>
      <td>1.691350</td>
      <td>English Renaissance</td>
    </tr>
    <tr>
      <th>4</th>
      <td>328</td>
      <td>1.837767</td>
      <td>Charpentier: Divertissements, Airs &amp; Concerts</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>One nice feature of this is that the column names in SQL get passed straight to the column names in our dataframe.</p>
</div>
<div class="section" id="sql-with-sqlmodel">
<h2>SQL with <strong>SQLModel</strong><a class="headerlink" href="#sql-with-sqlmodel" title="Permalink to this headline">¶</a></h2>
<p>Now, it’s not exactly satisfactory to have to write out your SQL queries in text. When you’re writing Python in Visual Studio Code (at least with the Python extensions installed), you get a lot of high quality syntax and auto-completion support. Extensions to the Python language also allow you to take a great deal of care over the types of variables that you are dealing with. Wouldn’t it be nice to have all of that with SQL too (even when accessing it via Python)?</p>
<p><a class="reference external" href="https://sqlmodel.tiangolo.com/"><strong>SQLModel</strong></a> brings some of those benefits, making working with SQL databases from Python a lot easier and more productive.</p>
<p>First, make sure you have the package installed by running <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">sqlmodel</span></code> on the command line.</p>
<div class="section" id="creating-a-sql-database-with-sqlmodel">
<h3>Creating a SQL Database with <strong>SQLModel</strong><a class="headerlink" href="#creating-a-sql-database-with-sqlmodel" title="Permalink to this headline">¶</a></h3>
<p>Imagine you have a SQL table called “hero” and you want it to have this data:</p>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>id</p></th>
<th class="head"><p>name</p></th>
<th class="head"><p>secret_name</p></th>
<th class="head"><p>age</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1</p></td>
<td><p>Deadpond</p></td>
<td><p>Dive Wilson</p></td>
<td><p>null</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>Spider-Boy</p></td>
<td><p>Pedro Parqueador</p></td>
<td><p>null</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>Rusty-Man</p></td>
<td><p>Tommy Sharp</p></td>
<td><p>48</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td><p>Ms Amazing</p></td>
<td><p>Barjabeen Bhabra</p></td>
<td><p>17</p></td>
</tr>
</tbody>
</table>
<p>Now, to create the SQL table, we write a structure called a <em>class</em>. Classes look a bit like functions but, in the body of this class, we list the name of the field followed by the Python code for the <em>type</em> of data represented:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span>

<span class="kn">from</span> <span class="nn">sqlmodel</span> <span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">Session</span><span class="p">,</span> <span class="n">SQLModel</span><span class="p">,</span> <span class="n">create_engine</span>


<span class="k">class</span> <span class="nc">Hero</span><span class="p">(</span><span class="n">SQLModel</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="nb">id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">secret_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">age</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<p>We then create the rows of data (this could be done programmatically but we’ll write them out here). Note that there is autocompletion of the fields in the below!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hero_1</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Deadpond&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Dive Wilson&quot;</span><span class="p">)</span>
<span class="n">hero_2</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Spider-Boy&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Pedro Parqueador&quot;</span><span class="p">)</span>
<span class="n">hero_3</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Rusty-Man&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Tommy Sharp&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">48</span><span class="p">)</span>
<span class="n">hero_4</span> <span class="o">=</span> <span class="n">Hero</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ms Amazing&quot;</span><span class="p">,</span> <span class="n">secret_name</span><span class="o">=</span><span class="s2">&quot;Barjabeen Bhabra&quot;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">17</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now we need to create the actual database and connect to it. The syntax is the name of the type of database, here sqlite, and then <code class="docutils literal notranslate"><span class="pre">:///</span></code> followed by the relative path to where you want to store the database.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">engine</span> <span class="o">=</span> <span class="n">create_engine</span><span class="p">(</span><span class="s2">&quot;sqlite:///data/hero.db&quot;</span><span class="p">)</span>

<span class="n">SQLModel</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">create_all</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_1</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_2</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_3</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">hero_4</span><span class="p">)</span>
    <span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can now get a read-out from the database we created using the direct approach (ie using the <strong>sqlite3</strong> package):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">con</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;data/hero.db&quot;</span><span class="p">)</span>

<span class="n">con</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM hero;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(1, &#39;Deadpond&#39;, &#39;Dive Wilson&#39;, None),
 (2, &#39;Spider-Boy&#39;, &#39;Pedro Parqueador&#39;, None),
 (3, &#39;Rusty-Man&#39;, &#39;Tommy Sharp&#39;, 48),
 (4, &#39;Ms Amazing&#39;, &#39;Barjabeen Bhabra&#39;, 17)]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="reading-from-sql-using-sqlmodel">
<h3>Reading from SQL using <strong>SQLModel</strong><a class="headerlink" href="#reading-from-sql-using-sqlmodel" title="Permalink to this headline">¶</a></h3>
<p><strong>SQLModel</strong> translates all of the usual SQL statements into functions. “SELECT” is no different. So let’s see an example of reading the SQL database directly from <strong>SQLModel</strong>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sqlmodel</span> <span class="kn">import</span> <span class="n">select</span>

<span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">statement</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Hero</span><span class="p">)</span>  <span class="c1"># Equivalent to SELECT * from hero</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>  <span class="c1"># Execute the command</span>
    <span class="k">for</span> <span class="n">hero</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">hero</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>secret_name=&#39;Dive Wilson&#39; name=&#39;Deadpond&#39; id=1 age=None
secret_name=&#39;Pedro Parqueador&#39; name=&#39;Spider-Boy&#39; id=2 age=None
secret_name=&#39;Tommy Sharp&#39; name=&#39;Rusty-Man&#39; id=3 age=48
secret_name=&#39;Barjabeen Bhabra&#39; name=&#39;Ms Amazing&#39; id=4 age=17
</pre></div>
</div>
</div>
</div>
<p>We can also get all of it back via <code class="docutils literal notranslate"><span class="pre">results.all()</span></code>. The resulting object is a list of “hero” objects whose properties can be accessed via <code class="docutils literal notranslate"><span class="pre">heroes[0].name</span></code> and so on.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">statement</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Hero</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
    <span class="n">heroes</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">heroes</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>secret_name=&#39;Dive Wilson&#39; name=&#39;Deadpond&#39; id=1 age=None
secret_name=&#39;Pedro Parqueador&#39; name=&#39;Spider-Boy&#39; id=2 age=None
secret_name=&#39;Tommy Sharp&#39; name=&#39;Rusty-Man&#39; id=3 age=48
secret_name=&#39;Barjabeen Bhabra&#39; name=&#39;Ms Amazing&#39; id=4 age=17
</pre></div>
</div>
</div>
</div>
<p>You can find more info in the <a class="reference external" href="https://sqlmodel.tiangolo.com/">documentation</a> for <strong>SQLModel</strong>, but most of the SQL query commands you’d expect are available. Let’s run an example from earlier:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">statement</span> <span class="o">=</span> <span class="n">select</span><span class="p">(</span><span class="n">Hero</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Hero</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="n">Hero</span><span class="o">.</span><span class="n">age</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span>
    <span class="n">heroes</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="n">heroes</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>secret_name=&#39;Barjabeen Bhabra&#39; name=&#39;Ms Amazing&#39; id=4 age=17
secret_name=&#39;Tommy Sharp&#39; name=&#39;Rusty-Man&#39; id=3 age=48
</pre></div>
</div>
</div>
</div>
<p>This has barely scraped the surface of what <strong>SQLModel</strong> can do: joins, updating data, deleting rows, and more are all possible too.</p>
</div>
</div>
<div class="section" id="where-to-learn-more-about-sql">
<h2>Where to Learn More About SQL<a class="headerlink" href="#where-to-learn-more-about-sql" title="Permalink to this headline">¶</a></h2>
<p>If you’ve finished this chapter and would like to learn more about SQL, here are some further resources:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://sqlfordatascientists.com"><em>SQL for Data Scientists</em></a> by Renée M. P. Teate is an introduction to SQL designed specifically for the needs of data scientists, and includes examples of the sort of highly interconnected data you’re likely to encounter in real organisations.</p></li>
<li><p><a class="reference external" href="https://www.practicalsql.com"><em>Practical SQL</em></a> by Anthony DeBarros is written from the perspective of a data journalist (a data scientist specialised in telling compelling stories) and goes into more detail about getting your data into a database and running your own DBMS.</p></li>
<li><p>Check out one of the many <a class="reference external" href="https://learnsql.com/blog/sql-basics-cheat-sheet/sql-basics-cheat-sheet-a3.pdf"><em>sql cheatsheets</em></a> that have all of the basics written in one place</p></li>
<li><p>Try out sql in your browser at <a class="reference external" href="https://sqlime.org/">SQLime</a></p></li>
<li><p>Learn SQL by solving a <a class="reference external" href="https://mystery.knightlab.com/">murder mystery</a></p></li>
</ul>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="import-databases-1"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>SQL is either pronounced “s”-“q”-“l” or “sequel”.</p>
</dd>
<dt class="label" id="import-databases-4"><span class="brackets"><a class="fn-backref" href="#id3">2</a></span></dt>
<dd><p>Confusingly, depending on the context, <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> is either a statement or a clause.
To avoid this confusion, we’ll generally use query instead of <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> statement.</p>
</dd>
<dt class="label" id="import-databases-5"><span class="brackets"><a class="fn-backref" href="#id4">3</a></span></dt>
<dd><p>Technically, only the <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> is required, since you can write queries like <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">1+1</span></code> to perform basic calculations. But if you want to work with data (as you always do!) you’ll also need a <code class="docutils literal notranslate"><span class="pre">FROM</span></code> clause.</p>
</dd>
</dl>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="data-sharing.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Sharing Data</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="data-advanced.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Advanced Data</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Arthur Turrell<br/>
        
            &copy; Copyright 2021.<br/>
          <div class="extra_footer">
            This book is available under an MIT license.
          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-9FZQCPFXZJ"></script>
<script>
                    window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('config', 'G-9FZQCPFXZJ');
                </script>

  </body>
</html>